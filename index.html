<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>GovMap – חיפוש שכבות</title>

  <script
    src="https://www.govmap.gov.il/govmap/api/govmap.api.js"
    defer
    onload="initGovMap()">
  </script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      height: 100vh;
      display: flex;
    }
    #sidebar {
      width: 280px;
      border-left: 1px solid #ddd;
      padding: 10px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    #map {
      flex: 1;
    }
    #layerSearch {
      width: 100%;
      padding: 5px 8px;
      box-sizing: border-box;
    }
    #layerList {
      flex: 1;
      overflow-y: auto;
      border: 1px solid #eee;
      padding: 5px;
    }
    .layer-item {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 2px 0;
      font-size: 14px;
    }
  </style>

  <script>
    // All layers you want available in your app
    const ALL_LAYERS = [
      { id: "PARCEL_ALL", name: "חלקות" },
      { id: "219092",    name: "שכבת IFRS / שכבת משתמש" },
      {id: "SUB_GUSH_ALL", name: "גושים"},
      {id: "atikot_sites_itm", name: "עתיקות"},
      {id: "Soil_survey", name: "סקר קרקעות"},
      { id: "4", name: "קווי רכבת קלה"},
      { id: "16", name: "כבישים משניים" },
      { id: "407", name: "תחנות רכבת" },
      { id: "151", name: "תחנות מטרו" },
      { id: "149", name: "תחנות רכבת קלה" },
      { id: "160", name: "קווי מטרו" },
      { id: "218852", name: "מאגר החלטות בהשגה ראשונה" },
      { id: "217414", name: "שומות מכריעות" },
      { id: "22", name: "שכונות" }
    ];

    function initGovMap() {
      const token = "f683abfd-c77e-461a-a41e-7a80d4b46cb2";

      govmap.createMap("map", {
        token: token,
        layers: ALL_LAYERS.map(l => l.id),     // all layers available
        background: "0",
        layersMode: 2,
        showXY: true,
        identifyOnClick: true,
        zoomButtons: true
      });

      renderLayerList(""); // first render with no filter
    }

    function renderLayerList(filterText) {
      const listEl = document.getElementById("layerList");
      listEl.innerHTML = "";

      const term = filterText.trim().toLowerCase();

      const filtered = ALL_LAYERS.filter(l =>
        l.name.toLowerCase().includes(term) ||
        l.id.toLowerCase().includes(term)
      );

      filtered.forEach(layer => {
        const row = document.createElement("div");
        row.className = "layer-item";

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = true; // you can sync from govmap later if you want
        checkbox.onchange = () => toggleLayer(layer.id, checkbox.checked);

        const label = document.createElement("span");
        label.textContent = `${layer.name} (${layer.id})`;

        row.appendChild(checkbox);
        row.appendChild(label);
        listEl.appendChild(row);
      });
    }

    function onLayerSearchInput() {
      const val = document.getElementById("layerSearch").value;
      renderLayerList(val);
    }

    function toggleLayer(layerId, turnOn) {
      if (turnOn) {
        govmap.setVisibleLayers([layerId], []);       // turn on only
      } else {
        govmap.setVisibleLayers([], [layerId]);       // turn off only
      }
    }
  </script>
</head>
<body>
  <div id="map"></div>

  <div id="sidebar">
    <input
      id="layerSearch"
      type="text"
      placeholder="חפש שכבה לפי שם / ID…"
      oninput="onLayerSearchInput()" />

    <div id="layerList"></div>
  </div>
</body>
</html>
